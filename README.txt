Some changes in visual and server code